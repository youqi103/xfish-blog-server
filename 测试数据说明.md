# 行为统计测试数据生成说明

## 数据生成结果

已成功生成以下测试数据：

| 数据类型 | 记录数 | 说明 |
|---------|--------|------|
| 访问记录 | 2121条 | 包含最近30天的访问数据 |
| 点赞记录 | 372条 | 包含文章和评论的点赞数据 |
| 评论记录 | 169条 | 包含不同状态的评论数据 |

## 数据特点

### 1. 访问数据
- 时间范围：最近30天
- 用户ID：6-18（有效用户）
- 访问来源：
  - 直接访问（50%）
  - 搜索引擎（25%）：Google、百度、Bing
  - 外部链接（25%）
- 目标类型：文章访问
- IP地址：随机生成192.168.x.x格式

### 2. 点赞数据
- 时间范围：最近30天
- 用户ID：6-18（有效用户）
- 目标类型：
  - 文章点赞（70%）
  - 评论点赞（30%）
- 目标ID：1-50（文章和评论ID）

### 3. 评论数据
- 时间范围：最近30天
- 用户ID：6-18（有效用户）
- 文章ID：1-50
- 评论状态分布：
  - 已发布（approved）：60%
  - 待审核（pending）：20%
  - 已拒绝（rejected）：10%
  - 已删除（spam）：10%
- 父评论：70%为顶级评论，30%为回复

### 4. 文章统计数据
- 文章ID：1-50
- 访问量：50-550（随机）
- 点赞数：10-110（随机）
- 评论数：5-55（随机）
- 分享数：2-22（随机）

## 如何查看统计效果

### 1. 启动后端服务
```bash
cd blog-backend/backUserCenter/user-center
mvn spring-boot:run
```

### 2. 启动前端服务
```bash
cd blog-admin/frontedUserCenter
npm run start:dev
```

### 3. 访问统计页面
打开浏览器访问：`http://localhost:8000/statistics`

## 预期效果

### 概览统计卡片
- **今日访问量**：显示最近一天的访问次数
- **总点赞数**：显示所有点赞总数
- **总评论数**：显示所有评论总数
- **活跃用户数**：显示最近7天有评论的用户数
- 每个卡片都会显示增长率（较昨日）

### 访问量趋势图
- 折线图显示最近7/30/90天的访问量变化
- X轴：日期
- Y轴：访问次数
- 支持时间范围切换

### 点赞趋势图
- 折线图显示最近7/30/90天的点赞量变化
- X轴：日期
- Y轴：点赞次数
- 支持时间范围切换

### 评论状态分布饼图
- 环形饼图显示评论状态分布
- 分类：
  - 已发布（approved）
  - 待审核（pending）
  - 已拒绝（rejected）
  - 已删除（spam）
- 显示百分比和数量

### 访问来源饼图
- 环形饼图显示访问来源分布
- 分类：
  - 直接访问
  - 搜索引擎
  - 外部链接
- 显示百分比和数量

### 热门文章点赞排行
- 表格显示点赞数最高的文章
- 列：排名、日期、点赞数
- 支持按点赞数排序

### 评论活跃度分析
- **日均评论数**：平均每天的评论数量
- **评论参与率**：评论数/访问量 * 100%
- **平均回复数**：每条评论的平均回复数
- **评论热度指数**：综合评分

### 小时分布柱状图
- 柱状图显示24小时的评论分布
- X轴：小时（0-23）
- Y轴：评论数量
- 可以看出用户活跃时间段

### 热门评论文章表格
- 表格显示评论数最高的文章
- 列：排名、文章标题、评论数
- 支持按评论数排序

## 数据刷新机制

1. **自动刷新**：切换时间范围时自动重新加载数据
2. **手动刷新**：可以刷新页面重新获取最新数据
3. **错误处理**：API调用失败时显示友好提示

## 注意事项

1. 测试数据是随机生成的，每次运行结果可能不同
2. 数据时间范围是最近30天，确保有足够的数据展示趋势
3. 所有数据都使用有效的用户ID（6-18），避免外键约束错误
4. 使用INSERT IGNORE避免重复键错误

## 扩展数据

如果需要更多测试数据，可以执行以下SQL：

```sql
-- 生成更多访问记录
INSERT IGNORE INTO visits (user_id, target_type, target_id, ip_address, user_agent, referrer, created_at)
SELECT 
    FLOOR(6 + RAND() * 13),
    'article',
    FLOOR(1 + RAND() * 50),
    CONCAT('192.168.', FLOOR(1 + RAND() * 255), '.', FLOOR(1 + RAND() * 255)),
    'Mozilla/5.0',
    CASE 
        WHEN RAND() < 0.5 THEN NULL
        WHEN RAND() < 0.75 THEN 'https://www.google.com'
        WHEN RAND() < 0.85 THEN 'https://www.baidu.com'
        WHEN RAND() < 0.95 THEN 'https://www.bing.com'
        ELSE 'https://example.com'
    END,
    DATE_SUB(CURDATE(), INTERVAL FLOOR(RAND() * 30) DAY);

-- 生成更多点赞记录
INSERT IGNORE INTO likes (user_id, target_type, target_id, created_at)
SELECT 
    FLOOR(6 + RAND() * 13),
    CASE WHEN RAND() < 0.7 THEN 'article' ELSE 'comment' END,
    FLOOR(1 + RAND() * 50),
    DATE_SUB(CURDATE(), INTERVAL FLOOR(RAND() * 30) DAY);

-- 生成更多评论记录
INSERT IGNORE INTO comments (article_id, user_id, parent_id, content, status, ip_address, user_agent)
SELECT 
    FLOOR(1 + RAND() * 50),
    FLOOR(6 + RAND() * 13),
    CASE WHEN RAND() < 0.7 THEN NULL ELSE FLOOR(1 + RAND() * 100) END,
    CONCAT('这是一条测试评论内容 ', FLOOR(RAND() * 1000)),
    CASE 
        WHEN RAND() < 0.6 THEN 'approved'
        WHEN RAND() < 0.8 THEN 'pending'
        WHEN RAND() < 0.9 THEN 'rejected'
        ELSE 'spam'
    END,
    CONCAT('192.168.', FLOOR(1 + RAND() * 255), '.', FLOOR(1 + RAND() * 255)),
    'Mozilla/5.0';
```

## 故障排查

### 图表没有数据
1. 检查后端服务是否正常运行
2. 检查数据库连接是否正常
3. 打开浏览器开发者工具查看API请求
4. 检查控制台是否有错误信息

### 数据显示异常
1. 检查数据库中是否有数据
2. 检查API返回的数据格式是否正确
3. 检查前端类型定义是否匹配

### 性能问题
1. 减少测试数据量
2. 检查数据库索引是否合理
3. 优化SQL查询语句

## 总结

测试数据已成功生成并可以正常展示行为统计页面的所有图表和统计信息。前后端数据对接已完成，所有功能都能正常工作。
